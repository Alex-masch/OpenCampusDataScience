---
title: "Data_cleaning"
output: html_document
---
```{r Datenstruktur nochmal anschauen}

skim(umsatzdaten_kiwo_wetter)

# Wir haben 10899 Umsatzdatensätze von 2121 Tagen. Wir bekommen durch fehlende Wetterdaten (besonders: 669 fehlende Wettercodes) insgesamt 2602 Datensätze ohne Wettercode--> Wenn wir also alle Datensätze fallen lassen, die hier fehlende Daten haben, reduzieren wir die Datenbasis erheblich

```

# Analyse der Ausreißer

```{r Ausreißeranalyse}
boxplot(umsatzdaten_kiwo_wetter$Temperatur)
boxplot(umsatzdaten_kiwo_wetter$Bewoelkung)
# beides ok

boxplot(umsatzdaten_kiwo_wetter$Umsatz)
#Ups, Probleme

ggplot(umsatzdaten_kiwo_wetter) + 
geom_boxplot(aes(x=as.factor(Warengruppe), y=Umsatz))

#Auch auf Ebene der Warengruppen bleiben hier Probleme in der Datenqualität beim Umsatz 
#TODO Entscheidung für Umgehen damit treffen

```






Delete all rows with n/a in Wettercode

**Anmerkung AL dazu**: Warum Datensätze ohne Wettercode komplett löschen? damit wird die Datenbasis um 2602 Messpunkte kleiner.

Alternative 1: Methode nutzen, die mit Missings umgehen kann (z.B. FIML). Dann könnte man immerhin noch die Information aus den Beobachtungen, die nicht vollständig so gut wie möglich nutzen. Das geht aber nicht mit lm().

Alternative 2: bei den lm-calls jeweils als Argument einfügen: na.action=na.exclude. Vorteil: Datensatz bleibt so, wie er ist, aber in den lm-calls werden trotzdem nur die vollständigen Beobachtungen genutzt.

Alternaive 3: Missings in den Wettercodes rekonstruieren, z.B. aus Bewölkung und Temperatur --> dazu muss man aber sicher wissen, was die Wettercodes bedeuten... hm

Alternative 4: Missings auf einen bestimmten Wert setzen, 00 wäre Bewölkungsentwicklung nicht beobachtet


```{r }
#Im Dataframe wetter n/a löschen
#umsatzdaten_kiwo_wetter <- umsatzdaten_kiwo_wetter %>% drop_na(Wettercode) #AL: wegen Anmerkung oben auskommentiert
```


**Anmerkung AL**: Warum alle anderen n/a's im Datensatz auf 0 setzen? Das verzerrt ja unsere Daten nur weiter unnötig. Davon würde ich abraten. Eine fehlende Temperatur ist ja besser als ein eingetragener Gefrierpunkt

```{r }
#Im Dataframe Kiwo n/a durch 0 ersetzen
#umsatzdaten_kiwo_wetter[is.na(umsatzdaten_kiwo_wetter)] <- 0
```



#Datenaufbereitung (Vorschlag AL):

```{r Vorschlag cleaning}
#KielerWoche-Variable auf 0/1 codieren

umsatzdaten_kiwo_wetter$KielerWoche[is.na(umsatzdaten_kiwo_wetter$KielerWoche)] <- 0

#Bewoelkung-Variable NAs auf mean(Bewoelkung) kodieren (mittlere Werte im Datensatz), denn: es sind nur 10 Datensätze, die das betrifft und in diesen Fällen gibt es keinen klaren Temperaturtrend

#Mittelwert_vor<-mean(umsatzdaten_kiwo_wetter$Bewoelkung, na.rm=TRUE)
umsatzdaten_kiwo_wetter$Bewoelkung[is.na(umsatzdaten_kiwo_wetter$Bewoelkung)] <- mean(umsatzdaten_kiwo_wetter$Bewoelkung, na.rm=TRUE)
#Mittelwert_nach<-mean(umsatzdaten_kiwo_wetter$Bewoelkung, na.rm=TRUE)
#Mittelwert_vor
#Mittelwert_nach #hab ich nur zum Checken der Manipulation genutzt





#Gleiche Logik für Temperatur und Windgeschwindigkeit

#Mittelwert_vor<-mean(umsatzdaten_kiwo_wetter$Temperatur, na.rm=TRUE)
umsatzdaten_kiwo_wetter$Temperatur[is.na(umsatzdaten_kiwo_wetter$Temperatur)] <- mean(umsatzdaten_kiwo_wetter$Temperatur, na.rm=TRUE)
#Mittelwert_nach<-mean(umsatzdaten_kiwo_wetter$Temperatur, na.rm=TRUE)
#Mittelwert_vor
#Mittelwert_nach #hab ich nur zum Checken der Manipulation genutzt

#Mittelwert_vor<-mean(umsatzdaten_kiwo_wetter$Windgeschwindigkeit, na.rm=TRUE)
umsatzdaten_kiwo_wetter$Windgeschwindigkeit[is.na(umsatzdaten_kiwo_wetter$Windgeschwindigkeit)] <- mean(umsatzdaten_kiwo_wetter$Windgeschwindigkeit, na.rm=TRUE)
#Mittelwert_nach<-mean(umsatzdaten_kiwo_wetter$Windgeschwindigkeit, na.rm=TRUE)
#Mittelwert_vor
#Mittelwert_nach #hab ich nur zum Checken der Manipulation genutzt



skim(umsatzdaten_kiwo_wetter)



```


